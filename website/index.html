<!DOCTYPE html>
<html lang="en">

<head>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link rel="stylesheet" href="animate.css">
		<link href="https://fonts.googleapis.com/css?family=Monoton|Orbitron&display=swap" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<header>
	<div class='wow bounceInRight'>
		<h1 class='neon' data-text="There Will Be Dogs">There Will Be Dogs</h1>
	</div>
		<h2 class="neon-body" data-text="Have our robot guess your dog's breed!">Have our robot guess your dog's breed!</h2>
</header>
<body>
		<div class="wow bounceInLeft">
			<img class='animated-gif' src="gif.gif" alt=”animated” />
		</div>
		<h3>
			<div class="instructions">
				Upload an image of your pupper and our robot technology will guess which breed your dog looks most similar to!
			</div>
		</h3>
		<div class="flier" id="label"></div>
		<input id="image-selector" type="file" size=".1"></input>
		<button onclick="getPreds()" id="predict-button">Predict</button>
		<img class='upimg' id="selected-image" src=""/>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        let base64Image;
				let extension;

        $("#image-selector").change(function() {
          let reader = new FileReader();
          reader.onload = function(e) {
                let dataURL = reader.result;
                $('#selected-image').attr("src", dataURL);
								extension = dataURL.split(';base64,')[0].split('/')[1];
                base64Image = dataURL.replace(/data:image\/(png|jpg|jpeg|JPG|JPEG|);base64,/,"");
            }
          reader.readAsDataURL($("#image-selector")[0].files[0]);
        });

				async function getPreds() {
					let message = {
						image: base64Image,
						type: extension
					};
					const dogresponse = await fetch("http://165.227.88.103:5000/predict",{
						method: 'POST',
						body: JSON.stringify(message)
					});
					const breedresponse = await fetch("http://165.227.88.103:8181/predict",{
						method: 'POST',
						body: JSON.stringify(message)
					});

					const yolo = await dogresponse.json();
					const breedjson = await breedresponse.json();

					var yoloimg = yolo.prediction;
					var outputImg = document.createElement('img');
					outputImg.setAttribute("class", "downimg");
					outputImg.setAttribute("id", "predimg");
					outputImg.src = yoloimg;
					document.body.appendChild(outputImg);

					var dog = yolo.label;
					var breed = breedjson.breed;
					if (dog == "NOT DOG"){
						$("#label").text(dog)
					} else {
						$("#label").text(breed)
					}

					return label;
				}

    </script>
		<script src="js/wow.min.js"></script>
		<script>
 		new WOW().init();
		</script>

</body>

</html>
